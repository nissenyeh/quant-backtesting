

# 經濟週期報酬率回測

根據 NBER (美國全國經濟研究所) 經濟週期數據和 Shiller S&P 指數，計算 1926-2022 年各經濟週期的報酬率統計。

## 研究動機

### 背景：

- [《景氣循環投資》](https://www.books.com.tw/products/0010840000?srsltid=AfmBOooghQUTc_RpIRdjR0G4Cpez-GhcaCOcQke-BRkLCUI-gaNND6tg)該書提到「榮景期末期」（通常是泡沫高峰）「應該持續做多但持股水位應該降低」（例如：剩下 30-50%股票就好）
   - Q：為什麼都知道泡沫快到頂端要衰退了，不乾脆放棄持股？
   - A：因為機會成本高，通常最後幾年是績效最好的時間。書中提到：「回顧過去 3 次榮景期（1988年~1990年、1999年~2001年、2006年~2007年) ，美股(標準普爾500 (S&P 500指數)平均的年化報酬率可達7.04% ，把這3個週期的最後1年(轉折年)扣掉,報酬率更是高達17.85%,十分驚人。不遜於復甦期和成長期的理想報酬率，是榮景期不可放棄做多的主要原因。」

###  研究目標

- 因此本研究想要回測看看，是否真的在「衰退期」的前1-3年報酬是最好的，來驗證「榮景期不應該輕易退出市場」的論述

- 資料來源

| 檔案 | 說明 | 來源 |
|------|------|------|
| `input_美國景氣循環完整年表_NBER.xlsx` | NBER 國家經濟研究院官方定義的「美國經濟週期高峰/谷底日期」 | [NBER國家經濟研究院](https://www.nber.org/research/data/us-business-cycle-expansions-and-contractions) |
| `input_SP指數(Shiller數據）.csv` | 諾貝爾經濟學得主Robert Shiller公開的「通膨調整後 S&P 總報酬指數」| [Robert Shiller](http://www.econ.yale.edu/~shiller/data.htm) |

## 研究結論

👉 **[完整分析報告](./report.md)**

### 關鍵發現

| 問題 | 結論 |
|------|------|
| 擴張期末期應該持續做多嗎？ | **是**，76.9% 機率有正報酬（平均 +14.80%） |
| 最後幾年報酬真的最好嗎？ | **部分正確**，衰退前2-3年 (11.6-11.7%) 略高於前1年 (9.98%) |
| 應該降低持股水位嗎？ | **是**，建議降至 50-70% 以控制風險 |
| 完全清倉好嗎？ | **不建議**，機會成本過高 |

### 操作建議

| 階段 | 建議持股水位 |
|------|-------------|
| 擴張期中段 | 80-100% |
| 疑似進入末期 | 50-70% |
| 確認衰退訊號 | 30-50% |

### 策略不適用情境

- 泡沫型擴張期（如 2000 年網路泡沫）
- 外部衝擊型衰退（如 2020 COVID、2022 暴力升息）
- 短擴張期（< 3年）
- 高估值環境（CAPE > 30）

## 目錄結構

```
period_return_backtest/
├── README.md                              # 本說明文件
├── report.md                              # 分析報告
├── economic_cycle_to_excel.py             # 主腳本
├── input_美國景氣循環完整年表_NBER.xlsx    # 輸入：NBER 經濟週期資料
├── input_SP指數(Shiller數據）.csv          # 輸入：Shiller S&P 總報酬指數
└── output_經濟週期報酬率分析.xlsx          # 輸出：分析結果 Excel
```


## 快速開始

### 1. 安裝依賴

```bash
pip install pandas openpyxl
```

### 2. 執行腳本

```bash
cd /stock-backtesting/period_return_backtest
python economic_cycle_to_excel.py
```

### 3. 查看輸出

輸出檔案：`output_經濟週期報酬率分析.xlsx`

## 輸出格式說明

| 欄位 | 說明 |
|------|------|
| 週期 | 週期名稱（僅在週期第一年顯示） |
| 年份 | 西元年 |
| 報酬率 | 該年 S&P 實質總報酬率（通膨調整+股息再投入） |
| 定義 | 擴張期 / 衰退期 |
| 附註 | 統計數據或事件描述 |

### 擴張期附註內容

擴張期第一年會顯示以下統計：

```
擴張期（共7年）平均報酬率：14.66%
擴張期（扣除倒數1年，共6年）平均報酬率：15.32%
擴張期（扣除倒數2年，共5年）平均報酬率：17.48%
衰退前1年報酬率：24.43%
衰退前2年平均報酬率：19.10%
衰退前3年平均報酬率：11.28%
```

### 樣式

- 每個週期用 **灰白相間** 背景色區分
- 奇數週期：白色背景
- 偶數週期：灰色背景

## 輸出範例

| 週期 | 年份 | 報酬率 | 定義 | 附註 |
|------|------|--------|------|------|
| 雷根牛市 (1982-11 → 1990-07) | 1983 | 18.67% | 擴張期 | 擴張期（共7年）平均報酬率：14.66%<br>擴張期（扣除倒數1年，共6年）平均報酬率：15.32%<br>擴張期（扣除倒數2年，共5年）平均報酬率：17.48%<br>衰退前1年報酬率：24.43%<br>衰退前2年平均報酬率：19.10%<br>衰退前3年平均報酬率：11.28% |
| | 1984 | 0.74% | 擴張期 | |
| | 1985 | 26.55% | 擴張期 | |
| | 1986 | 22.77% | 擴張期 | |
| | 1987 | -4.35% | 擴張期 | |
| | 1988 | 13.77% | 擴張期 | |
| | 1989 | 24.43% | 擴張期 | |
| 衰退期 (1990-07 → 1991-03)：儲貸危機 | 1990 | -7.97% | 衰退期 | 房產泡沫+波灣戰爭 |
| | 1991 | 18.44% | 衰退期 | |

## 如何更新資料

### 更新 NBER 經濟週期數據

1. 前往 [NBER Business Cycle Dating](https://www.nber.org/research/data/us-business-cycle-expansions-and-contractions)
2. 確認是否有新的經濟週期公告（高峰 Peak / 谷底 Trough 日期）
3. 更新 `input_美國景氣循環完整年表_NBER.xlsx`，新增最新週期
4. 同時更新 `economic_cycle_to_excel.py` 中的 `cycles` 列表

> **注意**：NBER 通常在衰退結束後 6-12 個月才會正式宣布週期日期，因此最新的週期可能會有延遲。

### 更新 Shiller 數據

1. 前往 [Shiller Data](http://www.econ.yale.edu/~shiller/data.htm)
2. 下載最新的 `ie_data.xls`
3. 提取 `Real Total Return Price` 欄位，另存為 `SP指數(Shiller數據）.csv`

### 新增經濟週期

編輯 `economic_cycle_to_excel.py` 中的 `cycles` 列表，新增週期：

```python
{"type": "擴張", "name": "新週期名稱 (開始 → 結束)", "years": [2023, 2024, 2025], "desc": ""},
```

## 使用 Claude Code 重新生成

### 更新回測腳本

如果需要調整格式或邏輯，可以使用以下 prompt：

```
請幫我更新經濟週期報酬率回測腳本：

輸入資料：
- /stock-backtesting/period_return_backtest/input_美國景氣循環完整年表_NBER.xlsx
- /stock-backtesting/period_return_backtest/input_SP指數(Shiller數據）.csv

輸出格式：
- 週期欄位：週期第一年顯示「週期名稱 (開始 → 結束)」
- 擴張期第一年附註：
  - 擴張期（共X年）平均報酬率
  - 擴張期（扣除倒數1年，共X年）平均報酬率
  - 擴張期（扣除倒數2年，共X年）平均報酬率
  - 衰退前1年報酬率
  - 衰退前2年平均報酬率
  - 衰退前3年平均報酬率
- 每個週期用灰白相間背景色區分
- 輸出至 Excel 檔案
```

### 產出分析報告

根據回測結果產出分析報告，可以使用以下 prompt：

```
請根據 /stock-backtesting/period_return_backtest 目錄下的回測結果，產出一份 report.md 分析報告。

報告內容：
1. 研究問題：驗證「榮景期末期應該持續做多但降低持股水位」是否有數據支持
2. 關鍵發現：
   - 衰退前1年正報酬的機率與平均報酬
   - 衰退前 1/2/3 年的報酬率比較
   - 最後1年對整體報酬的貢獻分析
3. 驗證書中提到的週期（1988-1990、1999-2001、2006-2007）
4. 操作建議：
   - 各階段建議持股水位
   - 風險控制方法
5. 策略不適用的情境（泡沫、外部衝擊、短週期、高估值）
6. 附錄：各擴張期完整統計數據表格
```

## 授權

